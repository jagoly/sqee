class CellSponzaStuff
{
    def CellSponzaStuff()
    {
        this.musicId = -1;
    }

    def on_load_finish()
    {
//        var music = sq_play_sound("music/MusicA", 2u);
//        music.enable_looping(true);

//        this.musicId = music.get_id();
    }
};

def load_other() {

//////////////////////////////////////////////////

mbus.send_Enable_SkyBox();
world.skybox.texture = "SkyBox/Miramar";
world.skybox.saturation = 1.0f;
world.skybox.brightness = 0.0f;
world.skybox.contrast = 1.0f;
world.skybox.opacity = 1.0f;

mbus.send_Enable_Ambient();
world.ambient.colour = Vec3F(0.4, 0.4, 0.4);

mbus.send_Enable_SkyLight();
world.skylight.rotation = QuatF(0.9233, 0.0654, 0.0);
world.skylight.colour = Vec3F(1.0, 0.8, 0.8);
world.skylight.density = 0.25f;
world.skylight.resolution = 1024u;
world.skylight.cascades = 4u;

//////////////////////////////////////////////////

var cell = sq_create_root_entity([]);
{
  var editEntity = sq_edit_Entity(cell);
  editEntity.set_unique_name("CellSponza");
}

var group; var leaf;

//////////////////////////////////////////////////

//var obj_TransformGroup = EntitySpec();
//obj_TransformGroup.add_component("Transform");

//var obj_SimpleStaticModel = EntitySpec();
//obj_SimpleStaticMesh.add_component("Transform");
//obj_SimpleStaticMesh.add_component("Model");
//obj_SimpleStaticMesh.add_component("Bounds");

//var obj_SimplePhysicsModel = EntitySpec();
//obj_SimplePhysicsModel.add_component("Transform");
//obj_SimplePhysicsModel.add_component("Physics");
//obj_SimplePhysicsModel.add_component("Model");
//obj_SimplePhysicsModel.add_component("Culling");

//var obj_YellowDice = clone(obj_SimplePhysicsModel);
//obj_YellowDice.physics["preset"] = "Test/Dice";
//obj_YellowDice.model["materials"] = ["Test/Dice"];
//obj_YellowDice.model["mesh"] = "Test/Dice";

//////////////////////////////////////////////////

var timeline = AnimationTimeline();
timeline.set_times([6u, 8u, 10u, 12u, 14u, 16u, 18u, 20u]);
timeline.add_Transform(Vec3F(0.0, 0.0, 0.0), QuatF(0.0, 0.0, 0.0), 0.4f);
timeline.add_Transform(Vec3F(0.0, 0.0, 1.0), QuatF(0.0, 0.2, 0.0), 0.6f);
timeline.add_Transform(Vec3F(0.0, 0.0, 2.0), QuatF(0.0, 0.8, 0.0), 0.8f);
timeline.add_Transform(Vec3F(0.0, 0.0, 3.0), QuatF(0.0, 0.2, 0.0), 1.0f);
timeline.add_Transform(Vec3F(0.0, 0.0, 4.0), QuatF(0.0, 0.8, 0.0), 1.2f);
timeline.add_Transform(Vec3F(0.0, 0.0, 5.0), QuatF(0.0, 0.2, 0.0), 1.4f);
timeline.add_Transform(Vec3F(0.0, 0.0, 6.0), QuatF(0.0, 0.8, 0.0), 1.6f);
timeline.add_Transform(Vec3F(0.0, 0.0, 7.0), QuatF(0.0, 0.2, 0.0), 1.8f);
timeline.add_Transform(Vec3F(0.0, 0.0, 8.0), QuatF(0.0, 0.0, 0.0), 2.0f);
timeline.debug_assert_sanity();

// DiceGroup
group = sq_create_entity(cell, ["Transform"]);
{
  var editEntity = sq_edit_Entity(group);
  editEntity.set_unique_name("DiceGroup");

  var editTransform = sq_edit_Transform(group);
  editTransform.set_position(Vec3F(0.0, 2.0, 6.0));
  editTransform.set_rotation(QuatF(0.0, 0.0, 0.125));
  editTransform.set_scale(0.5f);

  def print_foo(id)
  {
      print("foo");
      print(id);
  }

  var anim = sq_begin_animation(group, timeline);
//  anim.set_callback_on_end(print_foo);
}

  // DiceGroup.DiceA
  leaf = sq_create_entity(group, ["Transform", "Model"]);
//  leaf = create_entity(group, ["Transform", "Physics", "Render", "Culling"]);
  {
    var editTransform = sq_edit_Transform(leaf);
    editTransform.set_position(Vec3F(0.0, -0.5, 0.0));
    editTransform.set_rotation(QuatF(0.0, 0.0, 0.125));
    
//    var editPhysics = sys_Physics.edit(leaf);
//    editPhysics.set_preset_path("Test/Dice");
//    editPhysics.set_dynamic(true);
    
    var editModel = sq_edit_Model(leaf);
    editModel.set_stretch(Vec3F(1.0, 1.0, 2.0));
    editModel.add_material("Test:Dice");
    editModel.set_mesh("Test:Dice");
  }

  // DiceGroup.DiceB
  leaf = sq_create_entity(group, ["Transform", "Model"]);
  {
    var editTransform = sq_edit_Transform(leaf);
    editTransform.set_position(Vec3F(-0.5, 0.5, 0.0));

    var editModel = sq_edit_Model(leaf);
    editModel.add_material("Test:Dice");
    editModel.set_mesh("Test:Dice");
    editModel.enable_shadow(false);
  }
/*
// SqeenDead
leaf = sq_create_entity(cell, ["Transform", "Model", "Skeleton"]);
{
  var editTransform = sq_edit_Transform(leaf);
  editTransform.set_position(Vec3F(-0.8, 0.0, 0.05));
  editTransform.set_rotation(QuatF(0.75, 0.0, 0.25));

  var editModel = sq_edit_Model(leaf);
  editModel.add_material("Characters/SqeenHead");
  editModel.add_material("Characters/SqeenTorso");
  editModel.add_material("Characters/SqeenLegs");
  editModel.set_mesh("Characters/Sqeen");

  var editSkeleton = sq_edit_Skeleton(leaf);
  editSkeleton.set_armature("Characters/Sqeen");
  //editSkeleton.set_pose("Dead");
}
*/
// SpotNorth
/*leaf = create_entity(cell, ["Transform", "LightSpot"]);
{
  var editTransform = data_edit_Transform(leaf);
  editTransform.set_position(Vec3F(0.0, 7.0, 3.3));
  editTransform.set_rotation(QuatF(0.23, 0.0, 0.0));
  editTransform.set_scale(20.0f);

  var editLightSpot = data_edit_LightSpot(leaf);
  editLightSpot.set_colour(Vec3F(1.0, 1.0, 0.5));
  editLightSpot.set_softness(0.2f);
  editLightSpot.set_angle(0.07f);
  editLightSpot.set_resolution(256u);
}*/

/*
  // DiceGroup.DiceA
  leaf = create_entity(group, ["Transform", "Physics", "Model", "Bounds"]);
  sys_Transform[leaf].position = Vec3F(-0.2, 1.3, 0.6);
  sys_Transform[leaf].rotation = QuatF(0.0, 0.0, 0.125);
  sys_Physics[leaf].preset = "Test/Dice";
  sys_Physics[leaf].dynamic = true;
  sys_Model[leaf].stretch = Vec3F(1.0, 1.0, 2.0);
  sys_Model[leaf].materials = ["Test/Dice"];
  sys_Model[leaf].mesh = "Test/Dice";

  // DiceGroup.DiceB
  leaf = create_entity(group, ["Transform", "Physics", "Model"]);
  sys_Transform[leaf].position = Vec3F(-1.2, 0.6, 0.6);
  sys_Physics[leaf].preset = "Test/Dice";
  sys_Physics[leaf].dynamic = true;
  sys_Model[leaf].materials = ["Test/Dice"];
  sys_Model[leaf].mesh = "Test/Dice";
  sys_Model[leaf].enableShadow = false;
*/

/*
// SpotNorth
leaf = create_entity(cell, ["Transform", "SpotLight"]);
sys_Transform[leaf].position = Vec3F(0.0, 7.0, 3.3);
sys_Transform[leaf].rotation = QuatF(0.23, 0.0, 0.0);
sys_Transform[leaf].scale = 20.0f;
sys_SpotLight[leaf].colour = Vec3F(1.0, 1.0, 0.5);
sys_SpotLight[leaf].angle = 0.07f;
sys_SpotLight[leaf].softness = 0.2f;
sys_SpotLight[leaf].resolution = 256u;

// SpotNorth
leaf := eman.create(cell, "");
leaf.enable_component_Transform();
leaf.cTransform.position = Vec3F(0.0, 7.0, 3.3);
leaf.cTransform.rotation = QuatF(0.23, 0.0, 0.0);
leaf.cTransform.scale = 20.0f;
leaf.enable_component_LightSpot();
leaf.cLightSpot.colour = Vec3F(1.0, 1.0, 0.5);
leaf.cLightSpot.angle = 0.07f;
leaf.cLightSpot.softness = 0.2f;
leaf.cLightSpot.resolution = 256u;
sys_Transform.add_entity(leaf);

// PointCentre
leaf := eman.create(cell, "");
leaf.enable_component_Transform();
leaf.cTransform.position = Vec3F(0.0, 0.0, 3.0);
leaf.cTransform.scale = 6.0f;
leaf.enable_component_LightPoint();
leaf.cLightPoint.colour = Vec3F(0.5, 0.5, 1.0);
leaf.cLightPoint.resolution = 256u;
sys_Transform.add_entity(leaf);

// SplatBlood
leaf := eman.create(cell, "");
leaf.enable_component_Transform();
leaf.cTransform.position = Vec3F(5.0, 0.0, 0.0);
leaf.cTransform.rotation = QuatF(0.0, 0.0, 0.2);
leaf.enable_component_Decal();
leaf.cDecal.stretch = Vec3F(1.0, 1.0, 0.1);
leaf.cDecal.material = "Decals/Blood";
leaf.cDecal.alpha = 1.0f;
sys_Transform.add_entity(leaf);

// SqeenDead
leaf := eman.create(cell, "");
leaf.enable_component_Transform();
leaf.cTransform.position = Vec3F(-0.8, 0.0, 0.05);
leaf.cTransform.rotation = QuatF(0.25, 0.0, 0.25);
leaf.enable_component_Model();
leaf.cModel.mtrls = ["Characters/SqeenHead", "Characters/SqeenTorso", "Characters/SqeenLegs"];
leaf.cModel.mesh = "Characters/Sqeen";
leaf.enable_component_Skeleton();
leaf.cSkeleton.armature = "Characters/Sqeen";
leaf.cSkeleton.pose = "Dead";
sys_Transform.add_entity(leaf);

// SqeenEast
leaf := eman.create(cell, "");
leaf.enable_component_Transform();
leaf.cTransform.position = Vec3F(1.5, 0.0, 0.0);
leaf.cTransform.rotation = QuatF(0.0, 0.0, 0.25);
leaf.enable_component_Model();
leaf.cModel.mtrls = ["Characters/SqeenHead", "Characters/SqeenTorso", "Characters/SqeenLegs"];
leaf.cModel.mesh = "Characters/Sqeen";
leaf.enable_component_Skeleton();
leaf.cSkeleton.armature = "Characters/Sqeen";
leaf.cSkeleton.pose = "Squatting";
sys_Transform.add_entity(leaf);

// SqeenWest
leaf := eman.create(cell, "");
leaf.enable_component_Transform();
leaf.cTransform.position = Vec3F(-1.5, 0.0, 0.0);
leaf.cTransform.rotation = QuatF(0.0, 0.0, 0.75);
leaf.enable_component_Model();
leaf.cModel.mtrls = ["Characters/SqeenHead", "Characters/SqeenTorso", "Characters/SqeenLegs"];
leaf.cModel.mesh = "Characters/Sqeen";
leaf.enable_component_Skeleton();
leaf.cSkeleton.armature = "Characters/Sqeen";
leaf.cSkeleton.pose = "Standing";
sys_Transform.add_entity(leaf);
*/
/*for (var x = -1; x < 2; x += 1) {
    for (var y = -1; y < 2; y += 1) {
        for (var z = -1; z < 2; z += 1) {
            node := root.add_child("Point"+to_string(x)+to_string(y)+to_string(z));
            transform := node.add_TransformComponent();
            var offset = Vec3F(0.1f*float(x), 0.1f*float(y), 0.1f*float(z));
            transform.position = Vec3F(0.0, 0.0, 3.0) + offset;
            transform.scale = 6.0f;
            lightPoint := node.add_LightPointComponent();
            lightPoint.colour = Vec3F(1.0f/27.0f, 1.0f/27.0f, 1.0f/27.0f);
            lightPoint.resolution = 64u;
}}}*/


/*for (var x = -2; x < 3; x += 1) {
    for (var y = -2; y < 3; y += 1) {
        node := root.add_child("Point"+to_string(x)+to_string(y));
        transform := node.add_TransformComponent();
        var offset = Vec3F(0.1f*float(x), 0.1f*float(y), 0.0f);
        transform.position = Vec3F(0.0, 0.0, 3.0) + offset;
        transform.scale = 8.0f;
        lightPoint := node.add_LightPointComponent();
        lightPoint.colour = Vec3F(1.0f/25.0f, 1.0f/25.0f, 1.0f/25.0f);
        lightPoint.resolution = 128u;
}}*/

/*for (var x = -1; x < 2; x += 1) {
    for (var y = -1; y < 2; y += 1) {
        node := root.add_child("Point"+to_string(x)+to_string(y));
        transform := node.add_TransformComponent();
        var offset = Vec3F(0.1f*float(x), 0.1f*float(y), 0.0f);
        transform.position = Vec3F(0.0, 0.0, 3.0) + offset;
        transform.scale = 8.0f;
        lightPoint := node.add_LightPointComponent();
        lightPoint.colour = Vec3F(1.0f/9.0f, 1.0f/9.0f, 1.0f/9.0f);
        lightPoint.resolution = 128u;
}}*/
/*
node := root.add_child("OrthoFull");
transform := node.add_TransformComponent();
transform.position = Vec3F(16.5, 7.4, 17.01);
transform.rotation = QuatF(0.0767, 0.0654, 0.0);
lightOrtho = node.add_LightOrthoComponent();
lightOrtho.minimum = Vec3F(-31.0, -14.0, 0.0);
lightOrtho.maximum = Vec3F(7.0, 14.0, 33.0);
lightOrtho.density = 0.5f;
lightOrtho.resolution = 2048u;*/



/*
{ var eDicePhys = eRoot.add_child("DicePhys");
  { var cTransform = eDicePhys.add_TransformComponent();
    cTransform.position = Vec3F(0.0, 2.0, 0.0);
    var cDynamicBody = eDicePhys.add_DynamicBodyComponent();
    var cModel = eDicePhys.add_ModelComponent();
    cModel.mtrls = ["Test/Dice"];
    cModel.mesh = "Test/Dice";
    cModel.decals = false;
} }

{ var eBallPhys = eRoot.add_child("BallPhys");
  { var cTransform = eBallPhys.add_TransformComponent();
    cTransform.position.y = -2.0f;
    var cDynamicBody = eBallPhys.add_DynamicBodyComponent();
    var cModel = eBallPhys.add_ModelComponent();
    cModel.mtrls = ["Test/Ball"];
    cModel.mesh = "Test/Ball";
    cModel.decals = false;
} }

{ var eCheesePhys = eRoot.add_child("CheesePhys");
  { var cTransform = eCheesePhys.add_TransformComponent();
    cTransform.position = Vec3F(0.0, 0.0, 2.0);
    cTransform.rotation = QuatF(0.0, 0.0, 0.0);
//    cTransform.scale = 3.0f;
    var cDynamicBody = eCheesePhys.add_DynamicBodyComponent();
    var cModel = eCheesePhys.add_ModelComponent();
    cModel.mtrls = ["Test/Cheese"];
    cModel.mesh = "Test/Cheese";
    cModel.decals = false;
//    var cPointLight = eCheesePhys.add_PointLightComponent();
//    cPointLight.texsize = 128u;
} }

{ var eFloorPhys = eRoot.add_child("FloorPhys");
  { var cTransform = eFloorPhys.add_TransformComponent();
    var cStaticBody = eFloorPhys.add_StaticBodyComponent();
} }



{ var eSqeenDead = eRoot.add_child("SqeenDead");
  { var cTransform = eSqeenDead.add_TransformComponent();
    cTransform.position = Vec3F(-0.8f, 0.0f, 0.05f);
    cTransform.rotation = QuatF(0.25f, 0.0f, 0.25f);
    var cModel = eSqeenDead.add_ModelComponent();
    cModel.mesh = "Characters/Sqeen";
    cModel.skin = "Characters/Sqeen";
    cModel.arma = "Characters/Sqeen";
    cModel.pose = "Dead";
} }

{ var eSqeenEast = eRoot.add_child("SqeenEast");
  { var cTransform = eSqeenEast.add_TransformComponent();
    cTransform.position = Vec3F(1.5f, 0.0f, 0.0f);
    cTransform.rotation = QuatF(0.0f, 0.0f, 0.25f);
    var cModel = eSqeenEast.add_ModelComponent();
    cModel.mesh = "Characters/Sqeen";
    cModel.skin = "Characters/Sqeen";
    cModel.arma = "Characters/Sqeen";
    cModel.pose = "Squatting";
} }

{ var eSqeenWest = eRoot.add_child("SqeenWest");
  { var cTransform = eSqeenWest.add_TransformComponent();
    cTransform.position = Vec3F(-1.5f, 0.0f, 0.0f);
    cTransform.rotation = QuatF(0.0f, 0.0f, -0.25f);
    var cModel = eSqeenWest.add_ModelComponent();
    cModel.mesh = "Characters/Sqeen";
    cModel.skin = "Characters/Sqeen";
    cModel.arma = "Characters/Sqeen";
    cModel.pose = "Standing";
} }

{ var eSpotA = eRoot.add_child("SpotA");
  { var cTransform = eSpotA.add_TransformComponent();
    cTransform.position = Vec3F(0.0f, 7.0f, 3.3f);
    cTransform.rotation = QuatF(0.23f, 0.0f, 0.0f);
    cTransform.scale = 20.0f;
    var cSpotLight = eSpotA.add_SpotLightComponent();
    cSpotLight.angle = 0.07f;
    cSpotLight.softness = 0.2f;
    cSpotLight.texsize = 256u;
} }

{ var ePointCentre = eRoot.add_child("ePointCentre");
  { var cTransform = ePointCentre.add_TransformComponent();
    cTransform.position = Vec3F(0.0f, 0.0f, 3.0f);
    cTransform.scale = 6.0f;
    var cPointLight = ePointCentre.add_PointLightComponent();
    cPointLight.texsize = 256u;
} }

{ var eDecalCurtain = eRoot.add_child("eDecalCurtain");
  { var cTransform = eDecalCurtain.add_TransformComponent();
    cTransform.position = Vec3F(0.0f, 2.87f, 2.0f);
    cTransform.rotation = QuatF(-0.25f, 0.0f, 0.0f);
    var cDecal = eDecalCurtain.add_DecalComponent();
    cDecal.diff = cDecal.norm = cDecal.spec = "Blood";
    cDecal.scale = Vec3F(2.0f, 2.0f, 0.22f);
} }


{ var eFloorA = eRoot.add_child("FloorA");
  { var cTransform = eFloorA.add_TransformComponent();
    cTransform.position = Vec3F(0.0f, 0.0f, 0.0f);
    var cModel = eFloorA.add_ModelComponent();
    cModel.mesh = "Sponza/FloorA";
    cModel.skin = "Sponza/Floor";
    var cReflect = eFloorA.add_ReflectComponent();
    cReflect.factor = 0.5f;
} }
{ var eFloorB = eRoot.add_child("FloorB");
  { var cTransform = eFloorB.add_TransformComponent();
    cTransform.position = Vec3F(0.0f, 0.0f, 5.0f);
    var cModel = eFloorB.add_ModelComponent();
    cModel.mesh = "Sponza/FloorB";
    cModel.skin = "Sponza/Floor";
    var cReflect = eFloorB.add_ReflectComponent();
    cReflect.factor = 0.5f;
} }
{ var ePointNE = eRoot.add_child("ePointNE");
  { var cTransform = ePointNE.add_TransformComponent();
    cTransform.position = Vec3F(14.0f, 5.0f, 2.0f);
    cTransform.scale = 7.0f;
    var cPointLight = ePointNE.add_PointLightComponent();
    cPointLight.texsize = 256u;
} }
{ var ePointSE = eRoot.add_child("ePointSE");
  { var cTransform = ePointSE.add_TransformComponent();
    cTransform.position = Vec3F(14.0f, -5.0f, 2.0f);
    cTransform.scale = 7.0f;
    var cPointLight = ePointSE.add_PointLightComponent();
    cPointLight.texsize = 256u;
} }
{ var ePointNW = eRoot.add_child("ePointNW");
  { var cTransform = ePointNW.add_TransformComponent();
    cTransform.position = Vec3F(-14.0f, 5.0f, 2.0f);
    cTransform.scale = 7.0f;
    var cPointLight = ePointNW.add_PointLightComponent();
    cPointLight.texsize = 256u;
} }
{ var ePointSW = eRoot.add_child("ePointSW");
  { var cTransform = ePointSW.add_TransformComponent();
    cTransform.position = Vec3F(-14.0f, -5.0f, 2.0f);
    cTransform.scale = 7.0f;
    var cPointLight = ePointSW.add_PointLightComponent();
    cPointLight.texsize = 256u;
} }
*/

//////////////////////////////////////////////////

//eman.configure(cell, true);

var cellStuff = CellSponzaStuff();
cellStuff.on_load_finish();

}
